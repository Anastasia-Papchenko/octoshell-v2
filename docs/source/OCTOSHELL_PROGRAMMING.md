# Заметки о программировании в Octoshell

Здесь собраны некоторые заметки об устройстве Octhoshell, возможно, не полные.

## Как устроен Octoshell

Octoshell - приложение на Runy-on-Rails. Почти вся функциональность вынесена в
модули (engines). В основном приложении находится модель User, позволяющая
регистрироваться в Octoshell и выполнять минимальные действия. Ключевые модули -
Core (содержит понятия "проект", "кластер" и т.п.) и Face (содержит основной
шаблон страницы и интерфейс к главному меню).

## Оповещения (Notify)

Класс Notify определён в модуле Core. Он содержит поля:

- message:        текст
- count:          число копий уведомления (опционально)
- category:       0=уведомление для одного пользователя, 1=широковещательное, другое=по умолчанию не показывать
- kind:           строка (или nil) для выбора обработчика. nil = просто показать
- show_from:      nil или время с которого показывать уведомление
- show_till:      nil или время до которого показывать уведомление
- active:         nil/true/false. false = не показывать (nil/true = показываем)
- sourceble:      объект, к которому привязано оповещение (обычно пользователь, для category=0 обязательно пользователь)
- linkable:       связанный объект (опционально)

В ROOT/config/initializers/notice.rb (или в ином месте) можно зарегистрировать обработчик
определённого типа (kind) сообщений:

```
Core::Notice.register_kind 'mykind' do |notice, user, params, request|
  # nil
  # [:warn, "Your account is blocked now. Please, contact administrator here #{notice.message}."]
end
```

Обработчик принимает строку с типом оповещений и блок. Блок вызывается для проверки
того, надо ли показывать уведомление. Онвозвращает либо nil (не показывать), либо
массив из двух элементов: стиль уведомления ('success', 'ok', 'error', 'danger',
'alert', 'warn', 'warning', 'notice', 'info', либо явное имя css-стиля) и текст.
**Внимание!** текст будет показан с интерпретацией всех html-тегов!
